pipeline {
                agent any
                tools{
                           jdk  "JAVA_HOME"
	      maven "maven"
                           }
              stages {
        
                             stage("cleanup workspace"){

                                         steps{
                                                     cleanWs()
                                                    }
                                       }

                               stage("Checkout from SCM"){
                                          steps {
                                                 git branch: 'master', credentialsId: 'githttps', url: 'https://github.com/habeel143341/linuxhello'
                                                }

                                                         }    
                                stage("Build Application"){
                                            steps {
                                                   sh "mvn clean package"
                                                   }

                                                         }

                                stage("Test Application"){
                                             steps {
                                                       sh "mvn test"
                                                   }

                                                        }    


                             stage("Build & Push Docker Image") {
                                   steps {
                                   script {
                                   docker.withRegistry('',DOCKER_PASS) {
                                   docker_image = docker.build "${IMAGE_NAME}"
                                   }

                                   docker.withRegistry('',DOCKER_PASS) {
                                    docker_image.push("${IMAGE_TAG}")
                                   docker_image.push('latest')
                                    }
                                          }
                                   }

                                   }                           
                            }
            
        
    
          }
